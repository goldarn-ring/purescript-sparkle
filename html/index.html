<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="David Peter">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FlareCheck</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css" rel="stylesheet">
    <link href="main.css" rel="stylesheet">
  </head>
  <body>
    <a href="https://github.com/sharkdp/purescript-flarecheck" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <h1>FlareCheck</h1>
    FlareCheck is a library which allows you to create interactive test
    suites in an easy way.

    <blockquote>
      <b>Note:</b> <em>This is just an early-stage experiment. Any
        feedback and help is very much appreciated.</em>
    </blockquote>

    The idea is to use the <a href="https://github.com/sharkdp/purescript-flare">Flare</a>
    library and the power of PureScripts type system to create interactive
    testing environments in an easy way. This is in no way a replacement for properly
    written automated test suites but maybe could be useful for certain scenarios
    (similar to manual tests in psci).

    The library works in a similar way to QuickCheck, except that it creates
    HTML form fields for input parameters instead of using randomly generated data.

    <h2>Examples</h2>
    To create an interactive test suite for the three functions
<pre>
length :: String -&gt; Int
charCodeAt :: Int -&gt; String -&gt; Maybe Int
fromMaybe :: forall a. a -&gt; Maybe a -&gt; a</pre>

    from <code>Data.String</code> and <code>Data.Maybe</code>, we simply call
    the function <code>flareCheck</code>:

<pre>
module Test.Main

import Prelude
import Data.String
import Data.Tuple
import Test.FlareCheck

main = do
  flareCheck "length" length
  flareCheck "charCodeAt" $ uncurry charCodeAt
  flareCheck "fromMaybe" $ uncurry (fromMaybe :: Number -> _)
</pre>

    which creates the following three interactive tests:

    <div id="tests1"></div>

    Notice how the type information is used to automatically create appropriate
    input fields for <code>String</code>, <code>Int</code>, <code>Number</code>
    and <code>Maybe Number</code> (we have to use a type annotation for
    <code>fromMaybe</code> to get a concrete type).

    <h2>Custom input fields</h2>

    What if you want to test your own library with custom data types? Suppose
    we want to create a test for the following function from <code>Data.String.Regex</code>:
    <pre>match :: Regex -> String -> Maybe (Array (Maybe String))</pre>
    FlareCheck provides the type class <code>Flammable</code> (analogous to QuickChecks <code>Arbitrary</code>):
<pre>
class Flammable a where
  spark :: forall e. UI e a
</pre>
    where instances must provide a way to create a Flare
    UI which holds a value of type <code>a</code>.<br><br>

    To avoid orphan instances, we create a newtype wrapper and write a <code>Flammable</code>
    instance for <code>Regex</code>:
<pre>
newtype TRegex = TRegex Regex

instance flammableTRegex :: Flammable TRegex where
  spark = fieldset "Regex" $ TRegex <$>
            (regex <$> string "Pattern" "fo+"
                   <*> (parseFlags <$> string "Flags (g,i,m)" "g"))
</pre>

    Then, we can use <code>flareCheck</code> as before:
<pre>
flareCheck "match" $ uncurry2 $
  \(TRegex regex) string -> match regex string
</pre>
    to create the following interactive test:

    <div id="tests2"></div>

    <h2>Ideas, Questions, To do</h2>
    <ul>
      <li>I didn't manage to get rid of <code>uncurry</code>... doing something similar to
        QuickCheck does not work (I think) because Flare is just an Applicative and not a Monad
        and providing instances for <code>a1 -> a2 -> b</code> (etc.) did not work because
        of overlapping instance errors (which are due to the lack of type class interference, I believe).</li>
      <li>List / Array inputs would be very nice (this is related to <a href="https://github.com/sharkdp/purescript-flare/issues/2">Flare issue #2</a>)</li>
    </ul>

    <script type="text/javascript" src="main.js"></script>
  </body>
</html>
